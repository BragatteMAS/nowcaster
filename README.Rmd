---
output: github_document
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# nowcaster <a href='https://github.com/covid19br/nowcaster'><img src='man/figures/nowcaster.png' align="right" width="140" /></a> <a href='https://github.com/covid19br/nowcaster'><img src='man/figures/nowcaster_rev.png' align="right" width="140" /></a>


`nowcaster` is a R package for "nowcasting" epidemiological time-series. Every single system of notification has a intrinsic delay, `nowcaster` can estimate how many counts of any epidemiological data of interest (*i.e.*, daily cases and deaths counts) by fitting a binomial negative model to the time steps of delay between onset date of the event, (*i.e.*, date of first symptoms for cases or date of occurrence of death) and the date of report (*i.e.*, date of notification of the case or death)

`nowcaster` is based on the [`R-INLA`](https://becarioprecario.bitbucket.io/inla-gitbook/index.html) and [`INLA`](https://inla.r-inla-download.org/r-inla.org/doc/inla-manual/inla-manual.pdf) packages for "**I**ntegrated **N**ested **L**aplace **A**pproximation" algorithm to Bayesian inference. `INLA` is an alternative to others methods for Bayesian inference like **MCMC**, An introduction to `INLA` can be found [here](https://becarioprecario.bitbucket.io/inla-gitbook/index.html).

`nowcaster` is build for epidemiological emergency use, it was constructed for the Brazilian Severe Acute Respiratory Illness (SARI) surveillance database (SIVEP-Gripe). 

## Installing


To install `nowcaster` package simply run the code below in R:

```{r install}
devtools::install_github("covid19br/nowcaster")
```

After installing you can load the by typical library:

```{r library}
library(nowcaster)
```

## First example on LazyData

When the package is loaded it disponibilize a LazyData file, `sariBH`, it is a annonymized records of Severe Acute Respiratory Illness notified in the city of Belo Horizonte, since March 2020. To load it basically write:

```{r data-bh}
data<-sragBH
```

And we take a look on the data:

```{r lookup}
head(data)
```

It is a data.frame with 7 variables and 65,404 observations. We will make use of only the first two columns, "DT_SIN_PRI" and "DT_DIGITA" as well the column "Idade" to make age structured nowcasting.

Now we call the nowcasting function, it has by default the parametrization of take the data and estimating a structured age nowcasting, by fitting to each of age bins given to the function a $NegBinom$ function for the delay in days between the date of onset of symptoms and date of report. The mandatory parameter its `dataset`, to inform the dataset which will be used and `age_col`, to inform which is the age column. We pass three additional parameters, `data.by.week` to return the epidemiological curve out of window of act of nowcasting estimate and `return.age` to inform we desire a nowcasting result in two ways, the total aggregation estimate and the age-stratified estimate. The last parameter that we inform is in which bins of age will the estimate be stratified.

```{r nowcasting}
nowcasting_bh<-nowcasting_inla(dataset = data, 
                               bins_age = "10 years", 
                               data.by.week = T, 
                               return.age = T, 
                               age_col = Idade)
```




